---

resource_types:
- name: pull-request
  type: docker-image
  source:
    repository: jtarchie/pr

resources:
#- name: testrepo
#  type: git
#  source:
#    branch: master
#    uri: git@github.com:rhoughton-pivot/test_pr_resource

- name: pull-requests
  type: pull-request
  source:
    repo: rhoughton-pivot/test_pr_resource

jobs:
- name: test_pr_resource
  public: false
  serial: true
  plan:
  - get: pull-requests
#    params:
#      fetch_merge: true
    version: every
    trigger: true
  - task: sleep a while
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}
      outputs:
      - name: some_files
      run:
        path: sleep
        args:
        - 30

  - task:  test-output
    config:
      inputs:
      - name: some_files
      - name: pull-requests
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}
      run:
        path: cat
        args:
         - "./pull-requests/verfile"
    on_success:
      put: pull-requests
      params:
        path: pull-requests
        status: success
    on_failure:
      put: pull-requests
      params:
        path: pull-requests
        status: failure

